# äº§å“éœ€æ±‚æ–‡æ¡£ (PRD) - ç«™å†…ä¿¡å·²è¯»çŠ¶æ€åŠŸèƒ½

> éœ€æ±‚ç¼–å·ï¼šREQ-006
> äº§å“ç»ç†ï¼šå‡¯æ–‡
> åˆ›å»ºæ—¥æœŸï¼š2026-02-23
> æœ€åæ›´æ–°ï¼š2026-02-23
> çŠ¶æ€ï¼šå¾…è¯„å®¡

---

## ğŸ“‹ éœ€æ±‚æ¦‚è¿°

### åŠŸèƒ½åç§°
ç«™å†…ä¿¡å·²è¯»çŠ¶æ€åŠŸèƒ½

### éœ€æ±‚èƒŒæ™¯
å½“å‰ç«™å†…ä¿¡ç³»ç»Ÿç¼ºä¹æ¶ˆæ¯çŠ¶æ€è·Ÿè¸ªæœºåˆ¶ï¼Œæ— æ³•ç¡®è®¤å“ªäº›æˆå‘˜å·²é˜…è¯»é‡è¦é€šçŸ¥ï¼Œå¯¼è‡´æ²Ÿé€šæ•ˆç‡ä½ä¸‹å’Œè´£ä»»è¾¹ç•Œæ¨¡ç³Šã€‚

### ä¸šåŠ¡ä»·å€¼
1. **æå‡æ²Ÿé€šæ•ˆç‡**ï¼šæ˜ç¡®æ¶ˆæ¯é˜…è¯»çŠ¶æ€ï¼Œå‡å°‘é‡å¤æ²Ÿé€š
2. **è´£ä»»è¿½æº¯**ï¼šå»ºç«‹é˜…è¯»ç¡®è®¤æœºåˆ¶ï¼Œä¾¿äºé—®é¢˜è¿½è¸ª
3. **æµç¨‹è§„èŒƒ**ï¼šæ ‡å‡†åŒ–é‡è¦ä¿¡æ¯ä¼ è¾¾æµç¨‹

---

## ğŸ¯ ç›®æ ‡ç”¨æˆ·

| ç”¨æˆ·è§’è‰² | ä½¿ç”¨åœºæ™¯ | æ ¸å¿ƒéœ€æ±‚ |
|----------|----------|----------|
| å…¨ä½“æˆå‘˜ | æŸ¥çœ‹æ¶ˆæ¯é˜…è¯»çŠ¶æ€ | äº†è§£ä¿¡æ¯ä¼ è¾¾æƒ…å†µ |
| å‘é€è€… | ç¡®è®¤é‡è¦é€šçŸ¥è¢«é˜…è¯» | ç¡®ä¿ä¿¡æ¯æœ‰æ•ˆä¼ è¾¾ |
| ç®¡ç†è€… | ç›‘æ§æ•´ä½“é˜…è¯»æƒ…å†µ | æŒæ¡å›¢é˜Ÿæ²Ÿé€šçŠ¶æ€ |

---

## ğŸ“Š åŠŸèƒ½éœ€æ±‚

### 1. æ¶ˆæ¯çŠ¶æ€ç®¡ç†

#### 1.1 æ¶ˆæ¯çŠ¶æ€æ ‡è¯†
| çŠ¶æ€ | æ˜¾ç¤ºæ–¹å¼ | è¯´æ˜ |
|------|----------|------|
| æœªè¯» | åŠ ç²—æ˜¾ç¤º + çº¢ç‚¹æ ‡è®° | çªå‡ºæ˜¾ç¤ºï¼Œæé†’å¤„ç† |
| å·²è¯» | æ­£å¸¸å­—ä½“æ˜¾ç¤º | è¡¨ç¤ºå·²å¤„ç† |

#### 1.2 é˜…è¯»æ—¶é—´è®°å½•
- **é˜…è¯»æ—¶é—´æˆ³**ï¼šè®°å½•ç”¨æˆ·é¦–æ¬¡é˜…è¯»æ¶ˆæ¯çš„å…·ä½“æ—¶é—´
- **æ—¶é—´æ˜¾ç¤ºæ ¼å¼**ï¼šç›¸å¯¹æ—¶é—´ï¼ˆå¦‚"5åˆ†é’Ÿå‰"ã€"2å°æ—¶å‰"ï¼‰
- **è¯¦ç»†ä¿¡æ¯æŸ¥çœ‹**ï¼šç‚¹å‡»å¯æŸ¥çœ‹å…·ä½“é˜…è¯»äººå‘˜åˆ—è¡¨

#### 1.3 å·²è¯»äººæ•°ç»Ÿè®¡
- **å®æ—¶ç»Ÿè®¡**ï¼šæ˜¾ç¤º"å·²è¯» X/æ€»äººæ•°"
- **äººå‘˜åˆ—è¡¨**ï¼šå±•ç¤ºå·²è¯»å’Œæœªè¯»äººå‘˜è¯¦æƒ…

### 2. é˜…è¯»ç¡®è®¤æœºåˆ¶

#### 2.1 ç¡®è®¤æ–¹å¼
- **è‡ªåŠ¨ç¡®è®¤**ï¼šç”¨æˆ·é˜…è¯»æ¶ˆæ¯åè‡ªåŠ¨æ ‡è®°ä¸ºå·²è¯»
- **æ‰‹åŠ¨ç¡®è®¤**ï¼šæä¾›"å·²è¯»"æŒ‰é’®ä¾›ç”¨æˆ·ä¸»åŠ¨ç¡®è®¤

#### 2.2 ç¡®è®¤æ ¼å¼
```
å·²é˜… - [å§“å] - [æ—¶é—´]
ç¤ºä¾‹ï¼šå·²é˜… - å‡¯æ–‡ - 2026-02-23 15:30
```

#### 2.3 ç¡®è®¤ä½ç½®
- **æ¶ˆæ¯è¯¦æƒ…é¡µ**ï¼šåœ¨æ¶ˆæ¯æœ«å°¾æ·»åŠ ç¡®è®¤åŒºåŸŸ
- **åˆ—è¡¨é¡µ**ï¼šåœ¨æ¯æ¡æ¶ˆæ¯åæ˜¾ç¤ºç¡®è®¤æŒ‰é’®

### 3. æ¶ˆæ¯åˆ†ç±»ä¸ä¼˜å…ˆçº§

#### 3.1 æ¶ˆæ¯åˆ†ç±»
| ç±»å‹ | æ ‡è¯† | å¤„ç†ä¼˜å…ˆçº§ |
|------|------|----------|------|
| å…¬å‘Šé€šçŸ¥ | ğŸ”´ é«˜ | 24å°æ—¶å†…å¿…é¡»å¤„ç† |
| å·¥ä½œä»»åŠ¡ | ğŸŸ¡ ä¸­ | 3ä¸ªå·¥ä½œæ—¥å†…å¤„ç† |
| ä¸€èˆ¬ä¿¡æ¯ | ğŸŸ¢ ä½ | 7ä¸ªå·¥ä½œæ—¥å†…å¤„ç† |

#### 3.2 ä¼˜å…ˆçº§å¤„ç†è§„åˆ™
- **é«˜ä¼˜å…ˆçº§**ï¼šç«‹å³æ¨é€é€šçŸ¥ï¼Œå¼ºåˆ¶é˜…è¯»ç¡®è®¤
- **ä¸­ä¼˜å…ˆçº§**ï¼šæ¯æ—¥æ±‡æ€»æé†’ï¼Œæœªè¯»æ ‡è®°åŠ ç²—
- **ä½ä¼˜å…ˆçº§**ï¼šå¸¸è§„æ˜¾ç¤ºï¼Œå®šæœŸæ¸…ç†

---

## ğŸ—ï¸ æŠ€æœ¯æ–¹æ¡ˆ

### 1. æ•°æ®æ¨¡å‹è®¾è®¡

#### 1.1 æ¶ˆæ¯è¡¨ç»“æ„
```sql
CREATE TABLE internal_messages (
    id INT PRIMARY KEY AUTO_INCREMENT,
    title VARCHAR(200) NOT NULL COMMENT 'æ¶ˆæ¯æ ‡é¢˜',
    content TEXT NOT NULL COMMENT 'æ¶ˆæ¯å†…å®¹',
    sender_id INT NOT NULL COMMENT 'å‘é€è€…ID',
    message_type ENUM('announcement', 'task', 'info') DEFAULT 'info' COMMENT 'æ¶ˆæ¯ç±»å‹',
    priority ENUM('high', 'medium', 'low') DEFAULT 'medium' COMMENT 'ä¼˜å…ˆçº§',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE message_read_status (
    id INT PRIMARY KEY AUTO_INCREMENT,
    message_id INT NOT NULL COMMENT 'æ¶ˆæ¯ID',
    user_id INT NOT NULL COMMENT 'ç”¨æˆ·ID',
    read_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'é˜…è¯»æ—¶é—´',
    INDEX idx_message_user (message_id, user_id),
    FOREIGN KEY (message_id) REFERENCES internal_messages(id),
    FOREIGN KEY (user_id) REFERENCES users(id)
);
```

#### 1.2 çŠ¶æ€å­—æ®µè®¾è®¡
```json
{
  "messageStatus": {
    "unread": {
      "display": "bold",
      "color": "#ff4444",
      "icon": "unread-dot"
    },
    "read": {
      "display": "normal",
      "color": "#333333",
      "icon": "read-check"
    }
  },
  "priority": {
    "high": "#ff4444",
    "medium": "#ff9800",
    "low": "#4caf50"
  }
}
```

### 2. APIæ¥å£è®¾è®¡

#### 2.1 æ¶ˆæ¯åˆ—è¡¨æ¥å£
```javascript
GET /api/internal/messages
Response: {
  "success": true,
  "data": {
    "messages": [
      {
        "id": 1,
        "title": "æ–‡æ¡£ç®¡ç†è§„èŒƒå‘å¸ƒ",
        "content": "...",
        "sender": "å‰å§†",
        "type": "announcement",
        "priority": "high",
        "created_at": "2026-02-22T10:00:00Z",
        "read_status": {
          "total_readers": 2,
          "unread_readers": 3,
          "read_percentage": 40
        }
      }
    ],
    "pagination": {
      "current_page": 1,
      "total_pages": 5,
      "total_count": 25
    }
  }
}
```

#### 2.2 é˜…è¯»ç¡®è®¤æ¥å£
```javascript
POST /api/internal/messages/:id/read
Body: {
  "user_id": 123,
  "read_at": "2026-02-23T15:30:00Z"
}

Response: {
  "success": true,
  "message": "é˜…è¯»ç¡®è®¤æˆåŠŸ"
}
```

#### 2.3 çŠ¶æ€ç»Ÿè®¡æ¥å£
```javascript
GET /api/internal/messages/stats
Response: {
  "success": true,
  "data": {
    "total_messages": 100,
    "read_messages": 65,
    "unread_messages": 35,
    "read_rate": 65
  }
}
```

### 3. å‰ç«¯ç»„ä»¶è®¾è®¡

#### 3.1 æ¶ˆæ¯åˆ—è¡¨ç»„ä»¶
```jsx
const MessageList = () => {
  const [messages, setMessages] = useState([]);
  
  return (
    <div className="message-container">
      {messages.map(msg => (
        <MessageItem 
          key={msg.id}
          message={msg}
          onReadConfirm={handleReadConfirm}
        />
      ))}
    </div>
  );
};

const MessageItem = ({ message, onReadConfirm }) => {
  const isUnread = message.read_status.total_readers === 0;
  
  return (
    <div className={`message-item ${isUnread ? 'unread' : 'read'}`}>
      <div className="message-header">
        <span className={`priority-badge priority-${message.priority}`}>
          {message.priority}
        </span>
        <span className="sender">{message.sender}</span>
        <span className="time">
          {formatRelativeTime(message.created_at)}
        </span>
      </div>
      <div className="message-content">
        {message.content}
      </div>
      <div className="message-footer">
        <ReadStatus 
          messageId={message.id}
          onConfirm={onReadConfirm}
        />
      </div>
    </div>
  );
};
```

#### 3.2 é˜…è¯»çŠ¶æ€ç»„ä»¶
```jsx
const ReadStatus = ({ messageId, onConfirm }) => {
  const [readers, setReaders] = useState([]);
  const [showConfirm, setShowConfirm] = useState(false);
  
  return (
    <div className="read-status">
      {readers.length > 0 && (
        <div className="already-read">
          <span>å·²è¯» {readers.length} äºº</span>
          <button onClick={() => setShowConfirm(true)}>
            æŸ¥çœ‹è¯¦æƒ…
          </button>
        </div>
      )}
      
      {showConfirm && (
        <ConfirmDialog 
          onConfirm={() => onConfirm(messageId)}
          onCancel={() => setShowConfirm(false)}
        />
      )}
    </div>
  );
};
```

---

## ğŸ“± ç”¨æˆ·ä½“éªŒè®¾è®¡

### 1. äº¤äº’æµç¨‹

#### 1.1 æ¶ˆæ¯é˜…è¯»æµç¨‹
```mermaid
graph TD
    A[ç”¨æˆ·è¿›å…¥æ¶ˆæ¯åˆ—è¡¨] --> B[æŸ¥çœ‹æ¶ˆæ¯è¯¦æƒ…]
    B --> C{ç‚¹å‡»"å·²è¯»"æŒ‰é’®}
    C --> D[æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†]
    D --> E{ç”¨æˆ·ç¡®è®¤}
    E --> F[ç³»ç»Ÿè®°å½•é˜…è¯»æ—¶é—´]
    F --> G[æ¶ˆæ¯çŠ¶æ€æ›´æ–°ä¸ºå·²è¯»]
    G --> H[å®æ—¶æ›´æ–°å…¶ä»–ç”¨æˆ·ç•Œé¢]
```

#### 1.2 è‡ªåŠ¨é˜…è¯»æœºåˆ¶
- **æ»šåŠ¨é˜…è¯»**ï¼šç”¨æˆ·æ»šåŠ¨åˆ°æ¶ˆæ¯ä½ç½®è‡ªåŠ¨æ ‡è®°ä¸ºå·²è¯»
- **åœç•™é˜…è¯»**ï¼šç”¨æˆ·åœ¨æ¶ˆæ¯é¡µé¢åœç•™è¶…è¿‡3ç§’è‡ªåŠ¨æ ‡è®°
- **ç‚¹å‡»é˜…è¯»**ï¼šç”¨æˆ·ç‚¹å‡»æ¶ˆæ¯ä»»æ„ä½ç½®è‡ªåŠ¨æ ‡è®°

### 2. è§†è§‰è®¾è®¡è§„èŒƒ

#### 2.1 é¢œè‰²ä½“ç³»
| ç”¨é€” | é¢œè‰² | åå…­è¿›åˆ¶ |
|------|------|----------|----------|
| ä¸»è¦æ–‡å­— | #333333 | 0x333333 |
| å¼ºè°ƒæ–‡å­— | #ff4444 | 0xff4444 |
| æˆåŠŸçŠ¶æ€ | #4caf50 | 0x4caf50 |
| è­¦å‘ŠçŠ¶æ€ | #ff9800 | 0xff9800 |
| é“¾æ¥æ–‡å­— | #2196f3 | 0x2196f3 |
| èƒŒæ™¯è‰² | #f5f5f5 | 0xf5f5f5 |

#### 2.2 å­—ä½“è§„èŒƒ
| ç±»å‹ | å­—ä½“å¤§å° | å­—é‡ |
|------|----------|----------|----------|
| æ ‡é¢˜ | 16px | 600 |
| æ­£æ–‡ | 14px | 400 |
| æ—¶é—´æˆ³ | 12px | 300 |
| è¾…åŠ©æ–‡å­— | 12px | 300 |

---

## ğŸš€ å®æ–½è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼šåç«¯å¼€å‘ï¼ˆ3å¤©ï¼‰
- [x] æ¶ˆæ¯è¡¨ç»“æ„åˆ›å»º
- [x] APIæ¥å£å¼€å‘
- [x] é˜…è¯»ç¡®è®¤é€»è¾‘
- [x] çŠ¶æ€ç»Ÿè®¡åŠŸèƒ½

### ç¬¬äºŒé˜¶æ®µï¼šå‰ç«¯å¼€å‘ï¼ˆ5å¤©ï¼‰
- [x] æ¶ˆæ¯åˆ—è¡¨ç»„ä»¶
- [x] æ¶ˆæ¯è¯¦æƒ…ç»„ä»¶
- [x] é˜…è¯»çŠ¶æ€ç»„ä»¶
- [x] ç¡®è®¤å¯¹è¯æ¡†ç»„ä»¶

### ç¬¬ä¸‰é˜¶æ®µï¼šè”è°ƒæµ‹è¯•ï¼ˆ2å¤©ï¼‰
- [x] å‰åç«¯æ¥å£å¯¹æ¥
- [x] é˜…è¯»æµç¨‹æµ‹è¯•
- [x] å¤šç”¨æˆ·å¹¶å‘æµ‹è¯•

### ç¬¬å››é˜¶æ®µï¼šéƒ¨ç½²ä¸Šçº¿ï¼ˆ1å¤©ï¼‰
- [x] ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
- [x] åŠŸèƒ½éªŒè¯æµ‹è¯•
- [x] ç”¨æˆ·åŸ¹è®­æ–‡æ¡£

---

## ğŸ“Š æˆåŠŸæŒ‡æ ‡

### 1. åŠŸèƒ½æŒ‡æ ‡
| æŒ‡æ ‡ | ç›®æ ‡å€¼ | æµ‹é‡æ–¹å¼ |
|------|----------|----------|----------|
| æ¶ˆæ¯é˜…è¯»ç‡ | >80% | (å·²è¯»æ¶ˆæ¯æ•°/æ€»æ¶ˆæ¯æ•°) Ã— 100% |
| ç¡®è®¤å“åº”æ—¶é—´ | <2ç§’ | å‰ç«¯ç‚¹å‡»åˆ°åç«¯ç¡®è®¤æ—¶é—´ |
| çŠ¶æ€æ›´æ–°å®æ—¶æ€§ | <1ç§’ | WebSocketæ¨é€å»¶è¿Ÿ |

### 2. ä¸šåŠ¡æŒ‡æ ‡
| æŒ‡æ ‡ | ç›®æ ‡å€¼ | æµ‹é‡æ–¹å¼ |
|------|----------|----------|----------|
| æ²Ÿé€šæ•ˆç‡æå‡ | å‡å°‘30%é‡å¤æ²Ÿé€š | ç”¨æˆ·è°ƒç ”åé¦ˆ |
| è´£ä»»æ˜ç¡®åº¦ | 100%é‡è¦æ¶ˆæ¯æœ‰é˜…è¯»ç¡®è®¤ | ç³»ç»Ÿæ—¥å¿—åˆ†æ |
| æµç¨‹è§„èŒƒåŒ– | å»ºç«‹æ ‡å‡†æ“ä½œæµç¨‹ | æ–‡æ¡£ä½¿ç”¨æƒ…å†µç»Ÿè®¡ |

---

## âš ï¸ é£é™©ä¸çº¦æŸ

### 1. æŠ€æœ¯é£é™©
- **æ•°æ®ä¸€è‡´æ€§**ï¼šå¤šç”¨æˆ·åŒæ—¶é˜…è¯»å¯èƒ½å¯¼è‡´çŠ¶æ€å†²çª
- **æ€§èƒ½å½±å“**ï¼šå¤§é‡æ¶ˆæ¯æ—¶å®æ—¶æ›´æ–°å¯èƒ½å½±å“æ€§èƒ½
- **å…¼å®¹æ€§**ï¼šéœ€è¦æ”¯æŒä¸»æµæµè§ˆå™¨

### 2. ä¸šåŠ¡çº¦æŸ
- **é˜…è¯»ç¡®è®¤ä¸å¯é€†**ï¼šä¸€æ—¦ç¡®è®¤æ— æ³•æ’¤é”€
- **æ¶ˆæ¯ä¿ç•™æœŸ**ï¼šé‡è¦æ¶ˆæ¯ä¿ç•™30å¤©
- **æƒé™æ§åˆ¶**ï¼šåªæœ‰å‘é€è€…å’Œç®¡ç†å‘˜å¯æ’¤å›æ¶ˆæ¯

### 3. ä¾èµ–å…³ç³»
- **ä¾èµ–ç”¨æˆ·ç®¡ç†æ¨¡å—**ï¼šéœ€è¦ç”¨æˆ·IDå…³è”
- **ä¾èµ–é€šçŸ¥ç³»ç»Ÿ**ï¼šéœ€è¦æ¶ˆæ¯æ¨é€æœºåˆ¶
- **ä¾èµ–æƒé™ç³»ç»Ÿ**ï¼šéœ€è¦è§’è‰²æƒé™éªŒè¯

---

## ğŸ“ éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶
- [x] æ¶ˆæ¯åˆ—è¡¨æ­£ç¡®æ˜¾ç¤ºæœªè¯»/å·²è¯»çŠ¶æ€
- [x] é˜…è¯»ç¡®è®¤æœºåˆ¶æ­£å¸¸å·¥ä½œ
- [x] å®æ—¶çŠ¶æ€æ›´æ–°æ­£å¸¸
- [x] é˜…è¯»ç»Ÿè®¡å‡†ç¡®

### æ€§èƒ½éªŒæ”¶
- [x] 1000æ¡æ¶ˆæ¯åŠ è½½æ—¶é—´ <2ç§’
- [x] é˜…è¯»ç¡®è®¤å“åº”æ—¶é—´ <1ç§’
- [x] çŠ¶æ€æ›´æ–°å»¶è¿Ÿ <500ms

### ç”¨æˆ·ä½“éªŒéªŒæ”¶
- [x] æ–°ç”¨æˆ·æ— éœ€åŸ¹è®­å³å¯ä½¿ç”¨
- [x] äº¤äº’æµç¨‹ç¬¦åˆç”¨æˆ·ä¹ æƒ¯
- [x] è§†è§‰è®¾è®¡ç¬¦åˆè§„èŒƒ

---

*æœ¬PRDç»è¿‡äº§å“ç»ç†å‡¯æ–‡è¯¦ç»†è®¾è®¡ï¼Œæ¶µç›–åŠŸèƒ½éœ€æ±‚ã€æŠ€æœ¯æ–¹æ¡ˆã€å®æ–½è®¡åˆ’å’ŒéªŒæ”¶æ ‡å‡†ã€‚*